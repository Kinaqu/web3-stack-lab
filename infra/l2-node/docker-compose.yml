services:
  op-geth:
    image: us-docker.pkg.dev/oplabs-tools-artifacts/images/op-geth:v1.101605.0
    volumes:
      - .:/workspace
    working_dir: /workspace
    ports:
      - "8545:8545"
      - "8546:8546"
      - "8551:8551"
    command:
      - "--datadir=/workspace/op-geth-data"
      - "--http"
      - "--http.addr=0.0.0.0"
      - "--http.port=8545"
      - "--ws"
      - "--ws.addr=0.0.0.0"
      - "--ws.port=8546"
      - "--authrpc.addr=0.0.0.0"
      - "--authrpc.port=8551"
      - "--authrpc.jwtsecret=/workspace/jwt.txt"
      - "--syncmode=full"
      - "--gcmode=archive"
      - "--rollup.disabletxpoolgossip=true"
      - "--http.vhosts=*"
      - "--http.corsdomain=*"
      - "--http.api=eth,net,web3,debug,txpool,admin"
      - "--ws.origins=*"
      - "--ws.api=eth,net,web3,debug,txpool,admin"
      - "--authrpc.vhosts=*"

  op-node:
    image: us-docker.pkg.dev/oplabs-tools-artifacts/images/op-node:v1.16.5
    depends_on:
      - op-geth
    volumes:
      - .:/workspace
    working_dir: /workspace
    ports:
      - "8547:8547"
      - "9222:9222"
    environment:
      - L1_RPC_URL=${L1_RPC_URL}
      - L1_BEACON_URL=${L1_BEACON_URL}
      - PRIVATE_KEY=${PRIVATE_KEY}
      - P2P_ADVERTISE_IP=${P2P_ADVERTISE_IP}
    command:
      - "op-node"
      - "--l1=${L1_RPC_URL}"
      - "--l1.beacon=${L1_BEACON_URL}"
      - "--l2=http://op-geth:8551"
      - "--l2.jwt-secret=/workspace/jwt.txt"
      - "--rollup.config=/workspace/rollup.json"
      - "--sequencer.enabled=true"
      - "--sequencer.stopped=false"
      - "--sequencer.max-safe-lag=3600"
      - "--verifier.l1-confs=4"
      - "--p2p.listen.ip=0.0.0.0"
      - "--p2p.listen.tcp=9222"
      - "--p2p.listen.udp=9222"
      - "--p2p.advertise.ip=${P2P_ADVERTISE_IP}"
      - "--p2p.advertise.tcp=9222"
      - "--p2p.advertise.udp=9222"
      - "--p2p.sequencer.key=${PRIVATE_KEY}"
      - "--rpc.addr=0.0.0.0"
      - "--rpc.port=8547"
      - "--rpc.enable-admin"
      - "--log.level=info"
      - "--log.format=json"
